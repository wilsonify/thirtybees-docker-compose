var version="9.3.3",active_contextmenu=!0;function fix_colums(e){var a=$(".breadcrumb").width()+e;if($(".uploader").css("width",a),$("#view").val()>0){if(1==$("#view").val())$("ul.grid li, ul.grid figure").css("width","100%");else{var t=Math.floor(a/380);0==t&&(t=1,$("h4").css("font-size",12)),a=Math.floor(a/t-3),$("ul.grid li, ul.grid figure").css("width",a)}$("#help").hide()}else Modernizr.touch&&$("#help").show()}function swipe_reaction(e,a,t,i,r){var n=$(this);0==$("#view").val()&&(1==n.attr("toggle")?(n.attr("toggle",0),n.animate({top:"0px"},{queue:!1,duration:300})):(n.attr("toggle",1),n.animate({top:"-30px"},{queue:!1,duration:300})))}function apply(e,a){1==$("#popup").val()?window.opener:window.parent;var t=$("#cur_dir").val(),i=$("#base_url").val(),r=e.substr(0,e.lastIndexOf(".")),n=e.split(".").pop();n=n.toLowerCase();var l="";$.inArray(n,ext_img)>-1?l='<img src="'+i+t+e+'" alt="'+r+'" />':$.inArray(n,["mp4","ogg","webm"])>-1?l='<video controls source src="'+i+t+e+'" type="video/'+n+'">'+r+"</video>":$.inArray(n,["ogg","mp3","wav"])>-1?("mp3"==n&&(n="mpeg"),l='<audio controls src="'+i+t+e+'" type="audio/'+n+'">'+r+"</audio>"):l='<a href="'+i+t+e+'" title="'+r+'">'+r+"</a>",parent.tinymce.activeEditor.insertContent(l),parent.tinymce.activeEditor.windowManager.close()}function apply_link(e,a){if(1==$("#popup").val())var t=window.opener;else var t=window.parent;var i=$("#cur_dir").val();i=i.replace("\\","/");var r=$("#base_url").val();if(""!=a){var n=$("#"+a,t.document);$(n).val(r+i+e),$(n).trigger("change"),close_window()}else apply_any(r+i,e)}function apply_img(e,a){if(1==$("#popup").val())var t=window.opener;else var t=window.parent;var i=$("#cur_dir").val();i=i.replace("\\","/");var r=$("#base_url").val();if(""!=a){var n=$("#"+a,t.document);$(n).val(r+i+e),$(n).trigger("change"),close_window()}else apply_any(r+i,e)}function apply_video(e,a){if(1==$("#popup").val())var t=window.opener;else var t=window.parent;var i=$("#cur_dir").val();i=i.replace("\\","/");var r=$("#base_url").val();if(""!=a){var n=$("#"+a,t.document);$(n).val(r+i+e),$(n).trigger("change"),close_window()}else apply_any(i,e)}function apply_none(e,a){var t=$('li[data-name="'+e+'"]').find(".preview");if(""!=t.html()&&void 0!==t.html())$("#full-img").attr("src",decodeURIComponent(t.attr("data-url"))),!1==t.hasClass("disabled")&&(show_animation(),$("#previewLightbox").lightbox());else{var t=$('li[data-name="'+e+'"]').find(".modalAV");$("#previewAV").removeData("modal"),$("#previewAV").modal({backdrop:"static",keyboard:!1}),t.hasClass("audio")?$(".body-preview").css("height","80px"):$(".body-preview").css("height","345px"),$.ajax({url:decodeURIComponent(t.attr("data-url")),success:function(e){$(".body-preview").html(e)}})}}function apply_any(e,a){return e=e.replace("\\","/"),parent.tinymce.activeEditor.windowManager.getParams().setUrl(e+a),parent.tinymce.activeEditor.windowManager.close(),!1}function close_window(){1==$("#popup").val()?window.close():void 0!==parent.jQuery&&parent.jQuery?parent.jQuery.fancybox.close():parent.$.fancybox.close()}function apply_file_duplicate(e,a){var t=e.parent().parent().parent().parent();t.after("<li class='"+t.attr("class")+"' data-name='"+t.attr("data-name")+"'>"+t.html()+"</li>");var i=t.next();apply_file_rename(i.find("figure"),a);var r=i.find(".download-form"),n="form"+new Date().getTime();r.attr("id",n),r.find(".tip-right").attr("onclick","$('#"+n+"').submit();")}function apply_file_rename(e,a){e.attr("data-name",a),e.parent().attr("data-name",a),e.find("h4").find("a").text(a);var t=e.find("a.link"),i=t.attr("data-file"),r=i.substring(i.lastIndexOf("/")+1),n=i.substring(i.lastIndexOf(".")+1);t.each(function(){$(this).attr("data-file",encodeURIComponent(a+"."+n))}),e.find("img").each(function(){var e=$(this).attr("src");$(this).attr("src",e.replace(r,a+"."+n)),$(this).attr("alt",a+" thumbnails")});var l=e.find("a.preview"),i=l.attr("data-url");void 0!==i&&i&&l.attr("data-url",i.replace(encodeURIComponent(r),encodeURIComponent(a+"."+n))),e.parent().attr("data-name",a+"."+n),e.attr("data-name",a+"."+n),e.find(".name_download").val(a+"."+n);var o=e.find("a.rename-file"),c=e.find("a.delete-file"),s=o.attr("data-path"),d=o.attr("data-thumb"),f=s.replace(r,a+"."+n),u=d.replace(r,a+"."+n);o.attr("data-path",f),o.attr("data-thumb",u),c.attr("data-path",f),c.attr("data-thumb",u)}function apply_folder_rename(e,a){e.attr("data-name",a),e.find("figure").attr("data-name",a);var t=e.find("h4").find("a").text();e.find("h4 > a").text(a);var i=e.find(".folder-link"),r=i.attr("href"),n=$("#fldr_value").val(),l=r.replace("fldr="+n+encodeURIComponent(t),"fldr="+n+encodeURIComponent(a));i.each(function(){$(this).attr("href",l)});var o=e.find("a.delete-folder"),c=e.find("a.rename-folder"),s=c.attr("data-path"),d=c.attr("data-thumb"),f=s.lastIndexOf("/"),u=s.substr(0,f+1)+a;o.attr("data-path",u),c.attr("data-path",u);var f=d.lastIndexOf("/"),u=d.substr(0,f+1)+a;o.attr("data-thumb",u),c.attr("data-thumb",u)}function replace_last(e,a,t){var i=RegExp(a+"$");return e.replace(i,t)}function replaceDiacritics(e){for(var e,a=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],t=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],i=0;i<a.length;i++)e=e.replace(a[i],t[i]);return e}function fix_filename(e){return null!=e?(e=(e=(e=(e=(e=e.replace('"',"")).replace("'","")).replace("/","")).replace("\\","")).replace(/<\/?[^>]+(>|$)/g,""),$.trim(e)):null}function execute_action(e,a,t,i,r,n){null!==i&&(i=fix_filename(i),$.ajax({type:"POST",url:"execute.php?action="+e,data:{path:a,path_thumb:t,name:i.replace("/","")}}).done(function(e){return""!=e?(bootbox.alert(e),!1):(""!=n&&window[n](r,i),!0)}))}function sortUnorderedList(e,a,t){"string"==typeof e&&(e=$(e));var i=e.find("li.dir"),r=e.find("li.file"),n=[],l=[],o=[],c=[];$.each(i,function(e){var a=$(this),i=a.find(t).val();if($.isNumeric(i))for(i=parseFloat(i);void 0!==n[i]&&n[i];)i=parseFloat(parseFloat(i)+parseFloat(.001));else i=i+"a"+a.find("h4 a").attr("data-file");n[i]=a.html(),l.push(i)}),$.each(r,function(e){var a=$(this),i=a.find(t).val();if($.isNumeric(i))for(i=parseFloat(i);void 0!==o[i]&&o[i];)i=parseFloat(parseFloat(i)+parseFloat(.001));else i=i+"a"+a.find("h4 a").attr("data-file");o[i]=a.html(),c.push(i)}),$.isNumeric(l[0])?l.sort(function(e,a){return parseFloat(e)-parseFloat(a)}):l.sort(),$.isNumeric(c[0])?c.sort(function(e,a){return parseFloat(e)-parseFloat(a)}):c.sort(),a&&(l.reverse(),c.reverse()),$.each(i,function(e){$(this).html(n[l[e]])}),$.each(r,function(e){$(this).html(o[c[e]])})}function show_animation(){$("#loading_container").css("display","block"),$("#loading").css("opacity",".7")}function hide_animation(){$("#loading_container").fadeOut()}window.addEventListener("DOMContentLoaded",function(){$("body").queryLoader2({backgroundColor:"none",minimumTime:100,percentage:!0})}),$(document).ready(function(){active_contextmenu&&($.contextMenu({selector:"figure:not(.back-directory), .list-view2 figure:not(.back-directory)",autoHide:!0,build:function(e){e.addClass("selected");var a={callback:function(a,t){switch(a){case"copy_url":var i="";i+=$("#base_url").val()+$("#cur_dir").val(),""!=(add=e.find("a.link").attr("data-file"))&&null!=add&&(i+=add),bootbox.alert('URL:<br/><br/><input type="text" style="height:30px; width:100%;" value="'+i+'" />');break;case"unzip":var i=$("#fldr_value").val()+e.find("a.link").attr("data-file");$.ajax({type:"POST",url:"ajax_calls.php?action=extract",data:{path:i}}).done(function(e){""!=e?bootbox.alert(e):window.location.href=$("#refresh").attr("href")+"&"+new Date().getTime()});break;case"duplicate":var r=e.find("h4").text().trim();bootbox.prompt($("#lang_duplicate").val(),$("#cancel").val(),$("#ok").val(),function(a){if(null!==a&&(a=fix_filename(a))!=r){var t=e.find(".rename-file");execute_action("duplicate_file",t.attr("data-path"),t.attr("data-thumb"),a,t,"apply_file_duplicate")}},r)}},items:{}};return(e.find(".img-precontainer-mini .filetype").hasClass("png")||e.find(".img-precontainer-mini .filetype").hasClass("jpg")||e.find(".img-precontainer-mini .filetype").hasClass("jpeg"))&&image_editor&&(a.items.edit_img={name:$("#lang_edit_image").val(),icon:"edit_img",disabled:!1}),a.items.copy_url={name:$("#lang_show_url").val(),icon:"url",disabled:!1},(e.find(".img-precontainer-mini .filetype").hasClass("zip")||e.find(".img-precontainer-mini .filetype").hasClass("tar")||e.find(".img-precontainer-mini .filetype").hasClass("gz"))&&(a.items.unzip={name:$("#lang_extract").val(),icon:"extract",disabled:!1}),e.hasClass("directory")||1!=$("#duplicate").val()||(a.items.duplicate={name:$("#lang_duplicate").val(),icon:"duplicate",disabled:!1}),a.items.sep="----",a.items.info={name:"<strong>"+$("#lang_file_info").val()+"</strong>",disabled:!0},a.items.name={name:e.attr("data-name"),icon:"label",disabled:!0},"img"==e.attr("data-type")&&(a.items.dimension={name:e.find(".img-dimension").html(),icon:"dimension",disabled:!0}),a.items.size={name:e.find(".file-size").html(),icon:"size",disabled:!0},a.items.date={name:e.find(".file-date").html(),icon:"date",disabled:!0},a},events:{hide:function(e){$("figure").removeClass("selected")}}}),$(document).on("contextmenu",function(e){if(!$(e.target).is("figure"))return!1})),$("#full-img").on("click",function(){$("#previewLightbox").lightbox("hide")}),$("ul.grid").on("click",".modalAV",function(e){_this=$(this),e.preventDefault(),$("#previewAV").removeData("modal"),$("#previewAV").modal({backdrop:"static",keyboard:!1}),_this.hasClass("audio")?$(".body-preview").css("height","80px"):$(".body-preview").css("height","345px"),$.ajax({url:_this.attr("data-url"),success:function(e){$(".body-preview").html(e)}})}),$("input[name=radio-sort]").on("click",function(){var e=$(this).attr("data-item");$(".filters label").removeClass("btn-inverse"),$(".filters label").find("i").removeClass("icon-white"),$("#filter-input").val(""),$("#"+e).addClass("btn-inverse"),$("#"+e).find("i").addClass("icon-white"),"ff-item-type-all"==e?$(".grid li").show(300):$(this).is(":checked")&&($(".grid li").not("."+e).hide(300),$(".grid li."+e).show(300))});var e,a=(e=0,function(a,t){clearTimeout(e),e=setTimeout(a,t)});if(parseInt($("#file_number").val())>parseInt($("#file_number_limit_js").val()))var t=!1;else var t=!0;$("#filter-input").on("keyup",function(){$(".filters label").removeClass("btn-inverse"),$(".filters label").find("i").removeClass("icon-white"),$("#ff-item-type-all").addClass("btn-inverse"),$("#ff-item-type-all").find("i").addClass("icon-white");var e=fix_filename($(this).val());$(this).val(e),a(function(){t&&$("ul.grid li").each(function(){var a=$(this);""!=e&&-1==a.attr("data-name").toString().toLowerCase().indexOf(e.toLowerCase())?a.hide(100):a.show(100)})},300)}).keypress(function(e){13==e.which&&$("#filter").trigger("click")}),$("#filter").on("click",function(){var e=fix_filename($("#filter-input").val());window.location.href=$("#current_url").val()+"&filter="+e}),$("#info").on("click",function(){bootbox.alert('<center><img src="img/logo.png" alt="responsive filemanager"/><br/><br/><p><strong>RESPONSIVE filemanager v.'+version+'</strong><br/><a href="http://www.responsivefilemanager.com">responsivefilemanager.com</a></p><br/><p>Copyright \xa9 <a href="http://www.tecrail.com" alt="tecrail">Tecrail</a> - Alberto Peripolli. All rights reserved.</p><br/><p>License<br/><small><img alt="Creative Commons License" style="border-width:0" src="http://responsivefilemanager.com/license.php" /><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</small></p></center>')}),$("#uploader-btn").on("click",function(){var e=$("#fldr_value").val()+"/";e=e.substring(0,e.length-1),$("#iframe-container").html($("<iframe />",{name:"JUpload",id:"uploader_frame",src:"uploader/index.php?path="+e,frameborder:0,width:"100%",height:360}))}),$(".upload-btn").on("click",function(){$(".uploader").show(500)});var i="true"===$("#descending").val();$(".sorter").on("click",function(){_this=$(this),i=!i,t?($.ajax({url:"ajax_calls.php?action=sort&sort_by="+_this.attr("data-sort")+"&descending="+i}).done(function(e){}),sortUnorderedList("ul.grid",i,"."+_this.attr("data-sort")),$(" a.sorter").removeClass("descending").removeClass("ascending"),i?$(".sort-"+_this.attr("data-sort")).addClass("descending"):$(".sort-"+_this.attr("data-sort")).addClass("ascending")):window.location.href=$("#current_url").val()+"&sort_by="+_this.attr("data-sort")+"&descending="+i}),$(".close-uploader").on("click",function(){$(".uploader").hide(500),window.location.href=$("#refresh").attr("href")+"&"+new Date().getTime()}),$("ul.grid").on("click",".preview",function(){var e=$(this);return $("#full-img").attr("src",decodeURIComponent(e.attr("data-url"))),!1==e.hasClass("disabled")&&show_animation(),!0}),$("body").on("keypress",function(e){var a=String.fromCharCode(e.which);if("'"==a||'"'==a||"\\"==a||"/"==a)return!1}),$("ul.grid").on("click",".rename-file",function(){var e=$(this),a=e.parent().parent().parent(),t=a.find("h4"),i=$.trim(t.text());bootbox.prompt($("#rename").val(),$("#cancel").val(),$("#ok").val(),function(t){null!==t&&(t=fix_filename(t))!=i&&execute_action("rename_file",e.attr("data-path"),e.attr("data-thumb"),t,a,"apply_file_rename")},i)}),$("ul.grid").on("click",".rename-folder",function(){var e=$(this),a=e.parent().parent().parent(),t=a.find("h4"),i=$.trim(t.text());bootbox.prompt($("#rename").val(),$("#cancel").val(),$("#ok").val(),function(t){null!==t&&(t=fix_filename(t).replace(".",""))!=i&&execute_action("rename_folder",e.attr("data-path"),e.attr("data-thumb"),t,a,"apply_folder_rename")},i)}),$("ul.grid").on("click",".delete-file",function(){var e=$(this);bootbox.confirm(e.attr("data-confirm"),$("#cancel").val(),$("#ok").val(),function(a){!0==a&&(execute_action("delete_file",e.attr("data-path"),e.attr("data-thumb"),"","",""),e.parent().parent().parent().parent().remove())})}),$("ul.grid").on("click",".delete-folder",function(){var e=$(this);bootbox.confirm(e.attr("data-confirm"),$("#cancel").val(),$("#ok").val(),function(a){!0==a&&(execute_action("delete_folder",e.attr("data-path"),e.attr("data-thumb"),"","",""),e.parent().parent().parent().remove())})}),$(".new-folder").on("click",function(){bootbox.prompt($("#insert_folder_name").val(),$("#cancel").val(),$("#ok").val(),function(e){if(null!==e){e=fix_filename(e).replace(".","");var a=$("#fldr_value").val()+e,t=$("#cur_dir_thumb").val()+e;$.ajax({type:"POST",url:"execute.php?action=create_folder",data:{path:a,path_thumb:t}}).done(function(e){setTimeout(function(){window.location.href=$("#refresh").attr("href")+"&"+new Date().getTime()},300)})}},$("#new_folder").val())}),$(".view-controller button").on("click",function(){var e=$(this);$(".view-controller button").removeClass("btn-inverse"),$(".view-controller i").removeClass("icon-white"),e.addClass("btn-inverse"),e.find("i").addClass("icon-white"),$.ajax({url:"ajax_calls.php?action=view&type="+e.attr("data-value")}).done(function(e){""!=e&&bootbox.alert(e)}),void 0!==$("ul.grid")[0]&&$("ul.grid")[0]&&($("ul.grid")[0].className=$("ul.grid")[0].className.replace(/\blist-view.*?\b/g,"")),void 0!==$(".sorter-container")[0]&&$(".sorter-container")[0]&&($(".sorter-container")[0].className=$(".sorter-container")[0].className.replace(/\blist-view.*?\b/g,""));var a=e.attr("data-value");$("#view").val(a),$("ul.grid").addClass("list-view"+a),$(".sorter-container").addClass("list-view"+a),e.attr("data-value")>=1?fix_colums(14):($("ul.grid li").css("width",126),$("ul.grid figure").css("width",122))}),Modernizr.touch?($("#help").show(),$(".box:not(.no-effect)").swipe({swipeLeft:swipe_reaction,swipeRight:swipe_reaction,threshold:30})):($(".tip").tooltip({placement:"bottom"}),$(".tip-left").tooltip({placement:"left"}),$(".tip-right").tooltip({placement:"right"}),$("body").addClass("no-touch")),Modernizr.csstransforms||($("figure").bind("mouseover",function(){0==$("#view").val()&&$(this).find(".box:not(.no-effect)").animate({top:"-30px"},{queue:!1,duration:300})}),$("figure").mouseout(function(){0==$("#view").val()&&$(this).find(".box:not(.no-effect)").animate({top:"0px"},{queue:!1,duration:300})})),$(window).resize(function(){fix_colums(28)}),fix_colums(14),$("ul.grid").on("click",".link",function(){var e=$(this);window[e.attr("data-function")](e.attr("data-file"),e.attr("data-field_id"))})});